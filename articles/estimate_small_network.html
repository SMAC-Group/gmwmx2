<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimate a small network of GNSS station â€¢ gmwmx2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimate a small network of GNSS station">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gmwmx2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/load_plot_data_ngl.html">Load and plot data from the Nevada Geodetic Laboratory</a>
    </li>
    <li>
      <a href="../articles/fit_model.html">Estimate a model</a>
    </li>
    <li>
      <a href="../articles/estimate_small_network.html">Estimate a small network of GNSS station</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SMAC-Group/gmwmx2" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimate a small network of GNSS station</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SMAC-Group/gmwmx2/blob/main/vignettes/estimate_small_network.Rmd" class="external-link"><code>vignettes/estimate_small_network.Rmd</code></a></small>
      <div class="hidden name"><code>estimate_small_network.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SMAC-Group/gmwmx2" class="external-link">gmwmx2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="co"># library(rnaturalearth)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jessecambon.github.io/tidygeocoder/" class="external-link">tidygeocoder</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="define-some-functions-for-plotting">Define some functions for plotting<a class="anchor" aria-label="anchor" href="#define-some-functions-for-plotting"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define some function for plotting</span></span>
<span><span class="va">ellipse</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">hlaxa</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">hlaxb</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">theta</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">xc</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">yc</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">newplot</span> <span class="op">=</span> <span class="cn">F</span>, <span class="va">npoints</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">fill</span> <span class="op">=</span> <span class="cn">F</span>, <span class="va">fillColor</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span>, length <span class="op">=</span> <span class="va">npoints</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">hlaxa</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">hlaxb</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu">angle</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">rad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">xp</span> <span class="op">&lt;-</span> <span class="va">rad</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">theta</span><span class="op">)</span> <span class="op">+</span> <span class="va">xc</span></span>
<span>  <span class="va">yp</span> <span class="op">&lt;-</span> <span class="va">rad</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">theta</span><span class="op">)</span> <span class="op">+</span> <span class="va">yc</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">newplot</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xp</span>, <span class="va">yp</span>, type <span class="op">=</span> <span class="st">"l"</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xp</span>, <span class="va">yp</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">fill</span> <span class="op">==</span> <span class="cn">T</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="va">xp</span>, <span class="va">yp</span>, border <span class="op">=</span> <span class="cn">F</span>, col <span class="op">=</span> <span class="va">fillColor</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">angle</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">angle2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan</a></span><span class="op">(</span><span class="va">y</span><span class="op">/</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">y</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan</a></span><span class="op">(</span><span class="va">y</span><span class="op">/</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="va">pi</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">y</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">pi</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="kw">if</span> <span class="op">(</span><span class="va">y</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>          <span class="op">}</span></span>
<span>          <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="cn">NA</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">angle2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define function to make color transparent</span></span>
<span><span class="va">make_transparent</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">colors</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Ensure alpha is between 0 and 1</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">alpha</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">||</span> <span class="va">alpha</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Alpha value must be between 0 and 1"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Convert colors to RGB and add alpha</span></span>
<span>  <span class="va">transparent_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">colors</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">rgb_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">/</span> <span class="fl">255</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="va">rgb_val</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">rgb_val</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">rgb_val</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">transparent_colors</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimate-a-small-network-in-france">Estimate a small network in France<a class="anchor" aria-label="anchor" href="#estimate-a-small-network-in-france"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate little network in France</span></span>
<span><span class="va">all_station</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_all_stations_ngl.html">download_all_stations_ngl</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># download selected stations</span></span>
<span><span class="va">selected_station</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BSCN"</span>,<span class="st">"CERN"</span> ,<span class="st">"SCDA"</span>, <span class="st">"GLRA"</span>, <span class="st">"STPS"</span><span class="op">)</span></span>
<span><span class="co"># selected_station = c("BSCN")</span></span>
<span><span class="va">df_network</span> <span class="op">=</span> <span class="va">all_station</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">station_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">selected_station</span><span class="op">)</span></span>
<span><span class="va">df_network</span></span></code></pre></div>
<pre><code><span><span class="co">##    station_name latitude longitude    height</span></span>
<span><span class="co">##          &lt;char&gt;    &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">## 1:         BSCN 47.24688 -354.0106  359.5549</span></span>
<span><span class="co">## 2:         CERN 46.25695 -353.9394  525.9422</span></span>
<span><span class="co">## 3:         GLRA 44.83926 -355.4759  813.9238</span></span>
<span><span class="co">## 4:         SCDA 44.79452 -356.7325 1115.3433</span></span>
<span><span class="co">## 5:         STPS 46.30844 -356.7060  299.6851</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_estimated_velocities</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df_network</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">station_index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">df_network</span><span class="op">$</span><span class="va">station_name</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">station_name</span> <span class="op">=</span> <span class="va">df_network</span><span class="op">$</span><span class="va">station_name</span><span class="op">[</span><span class="va">station_index</span><span class="op">]</span></span>
<span>  <span class="co"># extract station</span></span>
<span>  <span class="va">station_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_station_ngl.html">download_station_ngl</a></span><span class="op">(</span>station_name <span class="op">=</span> <span class="va">station_name</span><span class="op">)</span></span>
<span>  <span class="va">fit_N</span> <span class="op">=</span> <span class="fu"><a href="../reference/gmwmx2.html">gmwmx2</a></span><span class="op">(</span><span class="va">station_data</span>, n_seasonal <span class="op">=</span> <span class="fl">2</span>, component <span class="op">=</span> <span class="st">"N"</span>, stochastic_model <span class="op">=</span> <span class="st">"wn + pl"</span><span class="op">)</span></span>
<span>  <span class="va">fit_E</span> <span class="op">=</span> <span class="fu"><a href="../reference/gmwmx2.html">gmwmx2</a></span><span class="op">(</span><span class="va">station_data</span>, n_seasonal <span class="op">=</span> <span class="fl">2</span>, component <span class="op">=</span> <span class="st">"E"</span>, stochastic_model <span class="op">=</span> <span class="st">"wn + pl"</span><span class="op">)</span></span>
<span>  <span class="va">df_estimated_velocities</span><span class="op">[</span><span class="va">station_index</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">station_name</span></span>
<span>  <span class="va">df_estimated_velocities</span><span class="op">[</span><span class="va">station_index</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_N</span><span class="op">$</span><span class="va">beta_hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">fit_N</span><span class="op">$</span><span class="va">std_beta_hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">fit_E</span><span class="op">$</span><span class="va">beta_hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">fit_E</span><span class="op">$</span><span class="va">std_beta_hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit_N</span><span class="op">$</span><span class="va">design_matrix_X</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Processing station "</span>,<span class="va">station_name</span>, <span class="st">" "</span>,  <span class="va">station_index</span> ,<span class="st">"/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">df_network</span><span class="op">$</span><span class="va">station_name</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Processing station BSCN 1/5</span></span>
<span><span class="co">## Processing station CERN 2/5</span></span>
<span><span class="co">## Processing station GLRA 3/5</span></span>
<span><span class="co">## Processing station SCDA 4/5</span></span>
<span><span class="co">## Processing station STPS 5/5</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_estimated_velocities</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station_name"</span>, <span class="st">"estimated_trend_N"</span>, <span class="st">"std_estimated_trend_N"</span>, <span class="st">"estimated_trend_E"</span>, <span class="st">"std_estimated_trend_E"</span>, <span class="st">"time_series_length"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">estimated_trend_N_scaled</span> <span class="op">=</span> <span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">estimated_trend_N</span> <span class="op">*</span> <span class="fl">365.25</span></span>
<span><span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">std_estimated_trend_N_scaled</span> <span class="op">=</span> <span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">std_estimated_trend_N</span> <span class="op">*</span> <span class="fl">365.25</span></span>
<span><span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">estimated_trend_E_scaled</span> <span class="op">=</span> <span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">estimated_trend_E</span>  <span class="op">*</span> <span class="fl">365.25</span></span>
<span><span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">std_estimated_trend_E_scaled</span> <span class="op">=</span>  <span class="va">df_estimated_velocities</span><span class="op">$</span><span class="va">std_estimated_trend_E</span> <span class="op">*</span> <span class="fl">365.25</span></span>
<span></span>
<span><span class="co"># transform longitude</span></span>
<span><span class="va">df_network</span><span class="op">$</span><span class="va">longitude2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df_network</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">180</span>,</span>
<span>                                <span class="va">df_network</span><span class="op">$</span><span class="va">longitude</span> <span class="op">+</span> <span class="fl">360</span>,</span>
<span>                                <span class="va">df_network</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># merge with location</span></span>
<span><span class="va">df_estimated_velocities_and_location</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_estimated_velocities</span>, <span class="va">df_network</span>, by<span class="op">=</span><span class="st">"station_name"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print estimated North and East velocities</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_estimated_velocities</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   station_name estimated_trend_N std_estimated_trend_N estimated_trend_E</span></span>
<span><span class="co">## 1         BSCN      4.435408e-05          3.262683e-07      5.345211e-05</span></span>
<span><span class="co">## 2         CERN      4.455772e-05          1.860753e-07      5.354428e-05</span></span>
<span><span class="co">## 3         GLRA      4.380876e-05          2.866518e-07      5.466610e-05</span></span>
<span><span class="co">## 4         SCDA      4.475967e-05          2.134131e-07      5.337310e-05</span></span>
<span><span class="co">## 5         STPS      4.481839e-05          2.197019e-07      5.248970e-05</span></span>
<span><span class="co">##   std_estimated_trend_E time_series_length estimated_trend_N_scaled</span></span>
<span><span class="co">## 1          2.187197e-07               8059               0.01620033</span></span>
<span><span class="co">## 2          1.384963e-07               4968               0.01627471</span></span>
<span><span class="co">## 3          3.368441e-07               5739               0.01600115</span></span>
<span><span class="co">## 4          1.454117e-07               6206               0.01634847</span></span>
<span><span class="co">## 5          1.217579e-07               6269               0.01636992</span></span>
<span><span class="co">##   std_estimated_trend_N_scaled estimated_trend_E_scaled</span></span>
<span><span class="co">## 1                 1.191695e-04               0.01952338</span></span>
<span><span class="co">## 2                 6.796401e-05               0.01955705</span></span>
<span><span class="co">## 3                 1.046996e-04               0.01996679</span></span>
<span><span class="co">## 4                 7.794912e-05               0.01949452</span></span>
<span><span class="co">## 5                 8.024612e-05               0.01917186</span></span>
<span><span class="co">##   std_estimated_trend_E_scaled</span></span>
<span><span class="co">## 1                 7.988737e-05</span></span>
<span><span class="co">## 2                 5.058577e-05</span></span>
<span><span class="co">## 3                 1.230323e-04</span></span>
<span><span class="co">## 4                 5.311164e-05</span></span>
<span><span class="co">## 5                 4.447209e-05</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_estimated_velocities</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="8%">
<col width="10%">
<col width="8%">
<col width="10%">
<col width="8%">
<col width="11%">
<col width="13%">
<col width="11%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">station_name</th>
<th align="right">estimated_trend_N</th>
<th align="right">std_estimated_trend_N</th>
<th align="right">estimated_trend_E</th>
<th align="right">std_estimated_trend_E</th>
<th align="right">time_series_length</th>
<th align="right">estimated_trend_N_scaled</th>
<th align="right">std_estimated_trend_N_scaled</th>
<th align="right">estimated_trend_E_scaled</th>
<th align="right">std_estimated_trend_E_scaled</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BSCN</td>
<td align="right">4.44e-05</td>
<td align="right">3e-07</td>
<td align="right">5.35e-05</td>
<td align="right">2e-07</td>
<td align="right">8059</td>
<td align="right">0.0162003</td>
<td align="right">0.0001192</td>
<td align="right">0.0195234</td>
<td align="right">7.99e-05</td>
</tr>
<tr class="even">
<td align="left">CERN</td>
<td align="right">4.46e-05</td>
<td align="right">2e-07</td>
<td align="right">5.35e-05</td>
<td align="right">1e-07</td>
<td align="right">4968</td>
<td align="right">0.0162747</td>
<td align="right">0.0000680</td>
<td align="right">0.0195570</td>
<td align="right">5.06e-05</td>
</tr>
<tr class="odd">
<td align="left">GLRA</td>
<td align="right">4.38e-05</td>
<td align="right">3e-07</td>
<td align="right">5.47e-05</td>
<td align="right">3e-07</td>
<td align="right">5739</td>
<td align="right">0.0160011</td>
<td align="right">0.0001047</td>
<td align="right">0.0199668</td>
<td align="right">1.23e-04</td>
</tr>
<tr class="even">
<td align="left">SCDA</td>
<td align="right">4.48e-05</td>
<td align="right">2e-07</td>
<td align="right">5.34e-05</td>
<td align="right">1e-07</td>
<td align="right">6206</td>
<td align="right">0.0163485</td>
<td align="right">0.0000779</td>
<td align="right">0.0194945</td>
<td align="right">5.31e-05</td>
</tr>
<tr class="odd">
<td align="left">STPS</td>
<td align="right">4.48e-05</td>
<td align="right">2e-07</td>
<td align="right">5.25e-05</td>
<td align="right">1e-07</td>
<td align="right">6269</td>
<td align="right">0.0163699</td>
<td align="right">0.0000802</td>
<td align="right">0.0191719</td>
<td align="right">4.45e-05</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="load-elevation-data-and-create-raster-for-plot">Load elevation data and create raster for plot<a class="anchor" aria-label="anchor" href="#load-elevation-data-and-create-raster-for-plot"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load elevation data</span></span>
<span><span class="va">tmp</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">elevation_data_swiss</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/elevation.html" class="external-link">elevation_30s</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"Switzerland"</span>, path <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="va">elevation_data_france</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/elevation.html" class="external-link">elevation_30s</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"France"</span>, path <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="va">elevation_data_italy</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/elevation.html" class="external-link">elevation_30s</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"Italy"</span>, path <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load raster</span></span>
<span><span class="va">elevation_raster_swiss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">elevation_data_swiss</span><span class="op">)</span></span>
<span><span class="va">elevation_raster_france</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">elevation_data_france</span><span class="op">)</span></span>
<span><span class="va">elevation_raster_italy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">elevation_data_italy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create combined raster</span></span>
<span><span class="va">combined_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">elevation_raster_swiss</span>, <span class="va">elevation_raster_france</span>,</span>
<span>                         <span class="va">elevation_raster_italy</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-estimated-n-e-velocities-and-associated-uncertainty">Plot estimated N-E velocities and associated uncertainty<a class="anchor" aria-label="anchor" href="#plot-estimated-n-e-velocities-and-associated-uncertainty"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sett plot limits</span></span>
<span><span class="va">xlims</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">ylims</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">44</span>, <span class="fl">48</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom color scale</span></span>
<span><span class="va">custom_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>   <span class="st">"#33660059"</span>, <span class="st">"#33CB6659"</span>, <span class="st">"#BAE39159"</span>, <span class="st">"#FEDBB859"</span>, <span class="st">"#F2C98859"</span>,</span>
<span>  <span class="st">"#E5B75859"</span>, <span class="st">"#D8A52759"</span>, <span class="st">"#A7991F59"</span>, <span class="st">"#A38F1959"</span>, <span class="st">"#A1851359"</span>, <span class="st">"#9E7B0D59"</span>, <span class="st">"#9B710759"</span>,</span>
<span>  <span class="st">"#98660059"</span>, <span class="st">"#A1595959"</span>, <span class="st">"#B1767659"</span>, <span class="st">"#B6929259"</span>, <span class="st">"#C1AFAF59"</span>, <span class="st">"#CBCBCB59"</span>, <span class="st">"#E4E4E459"</span>, <span class="st">"#FEFEFE59"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define breaks for the color scale based on the raster values</span></span>
<span><span class="va">raster_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">combined_raster</span><span class="op">)</span></span>
<span><span class="va">min_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">raster_values</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">max_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">raster_values</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate breaks based on the range of the raster data</span></span>
<span><span class="va">num_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">custom_colors</span><span class="op">)</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">min_val</span>, <span class="va">max_val</span>, length.out <span class="op">=</span> <span class="va">num_colors</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Get the country boundaries using geodata</span></span>
<span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/world.html" class="external-link">world</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter for the countries of interest</span></span>
<span><span class="va">countries</span> <span class="op">&lt;-</span> <span class="va">world</span><span class="op">[</span><span class="va">world</span><span class="op">$</span><span class="va">NAME_0</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Switzerland"</span>, <span class="st">"France"</span>, <span class="st">"Italy"</span>, <span class="st">"Germany"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">countries_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">countries</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="cn">NA</span>, xlim <span class="op">=</span> <span class="va">xlims</span>, ylim <span class="op">=</span> <span class="va">ylims</span>, las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">""</span>,xlab<span class="op">=</span><span class="st">""</span>,</span>
<span>     xaxt<span class="op">=</span><span class="st">"n"</span>, yaxt<span class="op">=</span><span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, labels <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, <span class="st">" E"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">50</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, labels <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">50</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, <span class="st">" N"</span><span class="op">)</span><span class="op">)</span>, las<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the elevation data</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">combined_raster</span>,</span>
<span>             col <span class="op">=</span> <span class="va">custom_colors</span>,</span>
<span>             <span class="co"># breaks=breaks,</span></span>
<span>             add <span class="op">=</span> <span class="cn">TRUE</span>,            <span class="co"># Add to the existing plot</span></span>
<span>             legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>        <span class="co"># Disable default legend</span></span>
<span></span>
<span><span class="co"># add axis</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>, <span class="fl">150</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">i</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lty<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">i</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lty<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># add points for station data</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">df_network</span><span class="op">$</span><span class="va">longitude2</span>, <span class="va">df_network</span><span class="op">$</span><span class="va">latitude</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># set param for graph</span></span>
<span><span class="va">shift</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">scale_arrow</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">arrow_width</span> <span class="op">=</span> <span class="fl">.1</span></span>
<span><span class="va">arrow_lwd</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">my_col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e96bff"</span><span class="op">)</span></span>
<span><span class="va">scale_ellipses</span><span class="op">=</span><span class="fl">3500</span></span>
<span><span class="va">my_col_trans</span> <span class="op">=</span> <span class="fu">make_transparent</span><span class="op">(</span><span class="va">my_col</span>,alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay country boundaries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">countries_sf</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="fu">ellipse</span><span class="op">(</span></span>
<span>    hlaxa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>,<span class="st">'std_estimated_trend_E_scaled'</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">scale_ellipses</span>,</span>
<span>    hlaxb <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>,<span class="st">'std_estimated_trend_N_scaled'</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">scale_ellipses</span>,</span>
<span>    theta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    xc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>,<span class="st">'longitude2'</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>,<span class="st">'estimated_trend_E_scaled'</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">scale_arrow</span>,</span>
<span>    yc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>,<span class="st">'latitude'</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>,<span class="st">'estimated_trend_N_scaled'</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">scale_arrow</span>,</span>
<span>    fill <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    fillColor <span class="op">=</span> <span class="va">my_col_trans</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    lw <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    col <span class="op">=</span> <span class="va">my_col_trans</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>, <span class="st">"longitude2"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>, <span class="st">"latitude"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>, <span class="st">"longitude2"</span><span class="op">]</span> <span class="op">+</span> <span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>, <span class="st">"estimated_trend_E_scaled"</span><span class="op">]</span> <span class="op">*</span> <span class="va">scale_arrow</span><span class="op">)</span></span>
<span>  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>, <span class="st">"latitude"</span><span class="op">]</span> <span class="op">+</span> <span class="va">df_estimated_velocities_and_location</span><span class="op">[</span><span class="va">i</span>, <span class="st">"estimated_trend_N_scaled"</span><span class="op">]</span> <span class="op">*</span> <span class="va">scale_arrow</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">shape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shape/man/Arrows.html" class="external-link">Arrows</a></span><span class="op">(</span></span>
<span>    x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, x1 <span class="op">=</span> <span class="va">x1</span>, y1 <span class="op">=</span> <span class="va">y1</span>,</span>
<span>    col <span class="op">=</span> <span class="va">my_col</span>,</span>
<span>    arr.type <span class="op">=</span> <span class="st">"triangle"</span>,</span>
<span>    arr.length <span class="op">=</span> <span class="fl">.10</span>,</span>
<span></span>
<span>    arr.width <span class="op">=</span> <span class="va">arrow_width</span>,</span>
<span>    lwd<span class="op">=</span><span class="va">arrow_lwd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># add</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_estimated_velocities_and_location</span><span class="op">$</span><span class="va">longitude2</span>, y<span class="op">=</span><span class="va">df_estimated_velocities_and_location</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>     labels <span class="op">=</span> <span class="va">df_estimated_velocities_and_location</span><span class="op">$</span><span class="va">station_name</span>, pos <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define cities</span></span>
<span><span class="va">df_city</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>address<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GenÃ¨ve"</span>,  <span class="st">"Clermont-Ferrand"</span>, <span class="st">"Dijon"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Load geolocalisation of cities</span></span>
<span><span class="va">df_geo</span> <span class="op">&lt;-</span> <span class="va">df_city</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://jessecambon.github.io/tidygeocoder/reference/geocode_combine.html" class="external-link">geocode_combine</a></span><span class="op">(</span></span>
<span>    queries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'osm'</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    global_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>address <span class="op">=</span> <span class="st">'address'</span><span class="op">)</span>,</span>
<span>    cascade <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## Passing 3 addresses to the Nominatim single address geocoder</span></span></code></pre>
<pre><code><span><span class="co">## Query completed in: 3 seconds</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_city_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_city</span>, <span class="va">df_geo</span><span class="op">)</span></span>
<span><span class="va">df_city_2</span><span class="op">$</span><span class="va">City</span> <span class="op">=</span> <span class="va">df_city_2</span><span class="op">$</span><span class="va">address</span></span>
<span></span>
<span><span class="co"># Add city to map</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">df_city_2</span><span class="op">$</span><span class="va">lon</span>, y<span class="op">=</span> <span class="va">df_city_2</span><span class="op">$</span><span class="va">lat</span>, pch<span class="op">=</span><span class="fl">15</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cex_size_city</span> <span class="op">=</span> <span class="fl">.7</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df_city_2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">df_city_2</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">df_city_2</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>       labels <span class="op">=</span> <span class="va">df_city_2</span><span class="op">$</span><span class="va">City</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>       adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"black"</span>,</span>
<span>       cex <span class="op">=</span> <span class="va">cex_size_city</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># add a legend</span></span>
<span><span class="va">twenty_mm_per_year</span> <span class="op">=</span> <span class="fl">.02</span></span>
<span><span class="va">twenty_mm_per_year_mm_per_year_scaled</span> <span class="op">=</span> <span class="va">twenty_mm_per_year</span><span class="op">*</span><span class="va">scale_arrow</span></span>
<span><span class="va">x_start</span> <span class="op">=</span> <span class="va">xlims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="fl">5</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">ylims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">.3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x_start</span>, y0 <span class="op">=</span> <span class="va">y</span>, x1 <span class="op">=</span> <span class="va">x_start</span><span class="op">+</span><span class="va">twenty_mm_per_year_mm_per_year_scaled</span>, y1 <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">delta_y</span><span class="op">=</span> <span class="fl">.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x_start</span>, x1 <span class="op">=</span> <span class="va">x_start</span>, y0 <span class="op">=</span> <span class="va">y</span><span class="op">+</span><span class="va">delta_y</span>, y1 <span class="op">=</span> <span class="va">y</span><span class="op">-</span><span class="va">delta_y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span>  <span class="va">x_start</span><span class="op">+</span><span class="va">twenty_mm_per_year_mm_per_year_scaled</span>, x1 <span class="op">=</span>  <span class="va">x_start</span><span class="op">+</span><span class="va">twenty_mm_per_year_mm_per_year_scaled</span>, y0 <span class="op">=</span> <span class="va">y</span><span class="op">+</span><span class="va">delta_y</span>, y1 <span class="op">=</span> <span class="va">y</span><span class="op">-</span><span class="va">delta_y</span><span class="op">)</span></span>
<span><span class="va">txt_size</span> <span class="op">=</span> <span class="fl">.8</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_start</span><span class="op">+</span><span class="va">twenty_mm_per_year_mm_per_year_scaled</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>     y <span class="op">=</span> <span class="va">y</span><span class="op">+</span><span class="fl">.1</span>,</span>
<span>     pos <span class="op">=</span> <span class="fl">3</span>,cex<span class="op">=</span><span class="va">txt_size</span>,</span>
<span>     labels <span class="op">=</span> <span class="st">"20 mm/year"</span><span class="op">)</span></span></code></pre></div>
<p><img src="estimate_small_network_files/figure-html/unnamed-chunk-5-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lionel Voirol, Haotian Xu, Yuming Zhang, Luca Insolia, Roberto Molinari, StÃ©phane Guerrier.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
